# Requirements Document

## Introduction

This document specifies the requirements for adding a native menu bar feature to TFM (TUI File Manager) when running in Desktop mode. The menu bar will provide a familiar desktop application interface with menus for common file operations, navigation, and application commands. The implementation will be flexible, with menu structure, actions, and enable/disable status managed by the TFM application rather than hard-coded in the TTK library. The feature will initially support macOS with future Windows support planned.

## Glossary

- **TFM**: TUI File Manager - the terminal-based file manager application
- **TTK**: Terminal ToolKit - the underlying UI library that provides cross-platform terminal and desktop rendering
- **Desktop Mode**: A mode where TFM runs as a native desktop application with a window (currently macOS only, Windows planned)
- **Menu Bar**: The horizontal bar at the top of a desktop application window containing dropdown menus
- **Menu Item**: An individual selectable option within a dropdown menu
- **MenuEvent**: An event object generated by TTK when a menu item is selected, delivered through the get_event() method
- **CoreGraphics Backend**: The macOS-specific TTK backend that renders using native macOS APIs
- **Enable/Disable Status**: The state of a menu item indicating whether it can be selected (enabled) or is grayed out (disabled)

## Requirements

### Requirement 1

**User Story:** As a TFM user running in Desktop mode, I want to access file operations through a menu bar, so that I can use familiar desktop application patterns.

#### Acceptance Criteria

1. WHEN TFM runs in Desktop mode THEN the system SHALL display a native menu bar at the top of the application window
2. WHEN a user clicks on a menu bar item THEN the system SHALL display a dropdown menu with available options
3. WHEN a user selects a menu item THEN the system SHALL execute the corresponding TFM action
4. WHERE Desktop mode is active, WHEN a menu item is disabled THEN the system SHALL display the item in a grayed-out state and prevent selection
5. WHERE Desktop mode is active, WHEN a menu item is enabled THEN the system SHALL display the item in normal state and allow selection

### Requirement 2

**User Story:** As a TFM developer, I want to define menu structure and behavior in the TFM application layer, so that I can easily modify menus without changing TTK library code.

#### Acceptance Criteria

1. WHEN TFM initializes Desktop mode THEN the system SHALL provide menu structure definitions to TTK through a configuration interface
2. WHEN menu structure is defined THEN the system SHALL support hierarchical menu organization with top-level menus and nested menu items
3. WHEN a menu item is defined THEN the system SHALL associate it with a unique identifier for action handling
4. WHEN menu configuration changes THEN the system SHALL allow dynamic updates to menu structure without restarting the application
5. THE TFM application SHALL control menu item enable/disable status based on application state

### Requirement 3

**User Story:** As a TFM developer, I want to receive menu selection events through TTK's event system, so that I can handle menu actions consistently with other input events.

#### Acceptance Criteria

1. WHEN a user selects a menu item THEN TTK SHALL generate a MenuEvent object
2. WHEN a MenuEvent is generated THEN the system SHALL include the menu item identifier in the event
3. WHEN TFM calls get_event() THEN the system SHALL return MenuEvent objects along with other event types
4. WHEN TFM receives a MenuEvent THEN the system SHALL provide sufficient information to identify which menu item was selected
5. THE MenuEvent SHALL follow the same event handling patterns as other TTK events

### Requirement 4

**User Story:** As a TFM user, I want standard File menu operations, so that I can perform common file management tasks through the menu bar.

#### Acceptance Criteria

1. WHEN the menu bar is displayed THEN the system SHALL include a File menu as the first menu
2. WHEN the File menu is opened THEN the system SHALL display options for New File, New Folder, Open, Delete, Rename, and Quit
3. WHEN a File menu operation is selected THEN the system SHALL execute the corresponding file operation on the current selection or cursor position
4. WHERE no files are selected, WHEN a file-specific operation is chosen THEN the system SHALL disable or gray out the menu item
5. WHEN the Quit menu item is selected THEN the system SHALL terminate the TFM application gracefully

### Requirement 5

**User Story:** As a TFM user, I want standard Edit menu operations, so that I can perform clipboard and selection operations through the menu bar.

#### Acceptance Criteria

1. WHEN the menu bar is displayed THEN the system SHALL include an Edit menu
2. WHEN the Edit menu is opened THEN the system SHALL display options for Copy, Cut, Paste, and Select All
3. WHEN a clipboard operation is selected THEN the system SHALL perform the operation on selected files
4. WHERE no files are selected, WHEN Copy or Cut is chosen THEN the system SHALL disable the menu item
5. WHERE the clipboard is empty, WHEN Paste is chosen THEN the system SHALL disable the menu item

### Requirement 6

**User Story:** As a TFM user, I want standard View menu operations, so that I can control display settings through the menu bar.

#### Acceptance Criteria

1. WHEN the menu bar is displayed THEN the system SHALL include a View menu
2. WHEN the View menu is opened THEN the system SHALL display options for Show Hidden Files, Sort By, and Refresh
3. WHEN Show Hidden Files is toggled THEN the system SHALL update the file list display accordingly
4. WHEN Sort By is selected THEN the system SHALL display a submenu with sorting options (Name, Size, Date, Extension)
5. WHEN a sort option is selected THEN the system SHALL re-sort the file list using the chosen criteria

### Requirement 7

**User Story:** As a TFM user, I want standard Go menu operations, so that I can navigate directories through the menu bar.

#### Acceptance Criteria

1. WHEN the menu bar is displayed THEN the system SHALL include a Go menu
2. WHEN the Go menu is opened THEN the system SHALL display options for Parent Directory, Home, Favorites, and Recent Locations
3. WHEN Parent Directory is selected THEN the system SHALL navigate to the parent of the current directory
4. WHERE the current directory is the root THEN the system SHALL disable the Parent Directory menu item
5. WHEN a navigation option is selected THEN the system SHALL change the current directory to the selected location

### Requirement 8

**User Story:** As a TFM developer, I want the menu system to support both macOS and Windows platforms, so that Desktop mode works consistently across operating systems.

#### Acceptance Criteria

1. WHEN menu bar code is implemented THEN the system SHALL use platform-agnostic interfaces in the TFM application layer
2. WHEN running on macOS THEN the system SHALL use the CoreGraphics backend to render native macOS menus
3. WHEN running on Windows THEN the system SHALL use a Windows-specific backend to render native Windows menus
4. WHEN platform-specific menu rendering is required THEN the system SHALL isolate platform code in TTK backend implementations
5. THE menu event handling SHALL remain consistent across platforms

### Requirement 9

**User Story:** As a TFM developer, I want to dynamically update menu item states, so that menu options reflect the current application context.

#### Acceptance Criteria

1. WHEN application state changes THEN the system SHALL allow TFM to update menu item enable/disable status
2. WHEN a menu is about to be displayed THEN the system SHALL query TFM for current menu item states
3. WHEN a menu item state is updated THEN the system SHALL reflect the change in the UI without requiring menu reconstruction
4. WHEN multiple menu items depend on the same state THEN the system SHALL update all affected items consistently
5. THE system SHALL support state updates for menu items at any level of the menu hierarchy

### Requirement 10

**User Story:** As a TFM user, I want keyboard shortcuts displayed in menus, so that I can learn and use keyboard shortcuts for common operations.

#### Acceptance Criteria

1. WHEN a menu item has an associated keyboard shortcut THEN the system SHALL display the shortcut to the right of the menu item text
2. WHEN a keyboard shortcut is pressed THEN the system SHALL execute the corresponding action without opening the menu
3. WHEN menu items are defined THEN the system SHALL allow TFM to specify keyboard shortcuts using platform-appropriate notation
4. WHERE a keyboard shortcut conflicts with existing bindings THEN the system SHALL prioritize the menu shortcut when menus are active
5. THE system SHALL display keyboard shortcuts using platform-standard formatting (e.g., âŒ˜C on macOS, Ctrl+C on Windows)
