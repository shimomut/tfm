<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1920 1080" width="1920" height="1080">
  <defs>
    <style>
      .title { font: bold 24px sans-serif; fill: #2c3e50; }
      .subtitle { font: bold 16px sans-serif; fill: #34495e; }
      .label { font: 13px sans-serif; fill: #2c3e50; }
      .small-label { font: 11px sans-serif; fill: #555; }
      .box { fill: #ecf0f1; stroke: #34495e; stroke-width: 2; }
      .core-box { fill: #3498db; stroke: #2980b9; stroke-width: 2; }
      .storage-box { fill: #e74c3c; stroke: #c0392b; stroke-width: 2; }
      .ui-box { fill: #2ecc71; stroke: #27ae60; stroke-width: 2; }
      .manager-box { fill: #f39c12; stroke: #d68910; stroke-width: 2; }
      .util-box { fill: #9b59b6; stroke: #8e44ad; stroke-width: 2; }
      .ttk-box { fill: #1abc9c; stroke: #16a085; stroke-width: 2; }
      .backend-box { fill: #95a5a6; stroke: #7f8c8d; stroke-width: 2; }
      .arrow { stroke: #7fb3d5; stroke-width: 2; fill: none; marker-end: url(#arrowhead); opacity: 0.7; }
      .data-arrow { stroke: #e74c3c; stroke-width: 2; fill: none; marker-end: url(#arrowhead-red); stroke-dasharray: 5,5; opacity: 0.7; }
      .white-text { fill: white; }
    </style>
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#7fb3d5" opacity="0.7" />
    </marker>
    <marker id="arrowhead-red" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#e74c3c" />
    </marker>
  </defs>

  <!-- ========== ARROWS LAYER (BACKGROUND) ========== -->
  <!-- FileManager to Managers -->
  <path d="M 960 150 L 200 240" class="arrow"/>
  <path d="M 960 150 L 450 240" class="arrow"/>
  <path d="M 960 150 L 700 240" class="arrow"/>
  <path d="M 960 150 L 950 240" class="arrow"/>
  <path d="M 960 150 L 1200 240" class="arrow"/>
  
  <!-- Managers to Path -->
  <path d="M 450 340 L 960 400" class="arrow"/>
  <path d="M 700 340 L 960 400" class="arrow"/>
  
  <!-- Path to Storage Implementations -->
  <path d="M 960 490 L 300 570" class="arrow"/>
  <path d="M 960 490 L 650 570" class="arrow"/>
  <path d="M 960 490 L 1000 570" class="arrow"/>
  
  <!-- Storage to Cache/Operations -->
  <path d="M 650 660 L 500 720" class="data-arrow"/>
  <path d="M 1000 660 L 850 720" class="arrow"/>
  
  <!-- Storage to External Systems -->
  <path d="M 300 660 L 300 950" class="data-arrow"/>
  <path d="M 650 660 L 150 950" class="data-arrow"/>
  <path d="M 1000 660 L 450 950" class="data-arrow"/>
  
  <!-- FileManager to TTK -->
  <path d="M 960 150 L 1600 240" class="arrow"/>
  
  <!-- TTK to Backends -->
  <path d="M 1600 340 L 1450 420" class="arrow"/>
  <path d="M 1600 340 L 1600 420" class="arrow"/>
  <path d="M 1600 340 L 1750 420" class="arrow"/>

  <!-- ========== CONTENT LAYER (FOREGROUND) ========== -->
  <!-- Title -->
  <text x="960" y="35" text-anchor="middle" class="title">TFM (TUI File Manager) Architecture</text>
  
  <!-- Legend -->
  <g transform="translate(50, 50)">
    <text x="0" y="0" class="small-label">Legend:</text>
    <rect x="0" y="8" width="50" height="18" class="core-box"/>
    <text x="58" y="22" class="small-label">Core</text>
    <rect x="110" y="8" width="50" height="18" class="storage-box"/>
    <text x="168" y="22" class="small-label">Storage</text>
    <rect x="230" y="8" width="50" height="18" class="ui-box"/>
    <text x="288" y="22" class="small-label">UI</text>
    <rect x="330" y="8" width="50" height="18" class="manager-box"/>
    <text x="388" y="22" class="small-label">Managers</text>
    <rect x="460" y="8" width="50" height="18" class="util-box"/>
    <text x="518" y="22" class="small-label">Utils</text>
    <rect x="570" y="8" width="50" height="18" class="ttk-box"/>
    <text x="628" y="22" class="small-label">TTK</text>
    <rect x="670" y="8" width="50" height="18" class="backend-box"/>
    <text x="728" y="22" class="small-label">Backend</text>
  </g>

  <!-- Main Application Layer -->
  <g transform="translate(810, 90)">
    <rect x="0" y="0" width="300" height="70" class="core-box" rx="5"/>
    <text x="150" y="28" text-anchor="middle" class="subtitle white-text">FileManager</text>
    <text x="150" y="45" text-anchor="middle" class="small-label white-text">(tfm_main.py)</text>
    <text x="150" y="60" text-anchor="middle" class="small-label white-text">Main application controller</text>
  </g>

  <!-- Core Managers Layer -->
  <g transform="translate(50, 240)">
    <!-- PaneManager -->
    <rect x="0" y="0" width="200" height="100" class="manager-box" rx="5"/>
    <text x="100" y="28" text-anchor="middle" class="subtitle white-text">PaneManager</text>
    <text x="100" y="48" text-anchor="middle" class="small-label white-text">Dual pane</text>
    <text x="100" y="65" text-anchor="middle" class="small-label white-text">Navigation</text>
    <text x="100" y="82" text-anchor="middle" class="small-label white-text">Cursor history</text>

    <!-- FileOperations -->
    <rect x="250" y="0" width="200" height="100" class="manager-box" rx="5"/>
    <text x="350" y="28" text-anchor="middle" class="subtitle white-text">FileOperations</text>
    <text x="350" y="48" text-anchor="middle" class="small-label white-text">Copy, move</text>
    <text x="350" y="65" text-anchor="middle" class="small-label white-text">Delete, rename</text>
    <text x="350" y="82" text-anchor="middle" class="small-label white-text">Selection</text>

    <!-- LogManager -->
    <rect x="500" y="0" width="200" height="100" class="manager-box" rx="5"/>
    <text x="600" y="28" text-anchor="middle" class="subtitle white-text">LogManager</text>
    <text x="600" y="48" text-anchor="middle" class="small-label white-text">Logging</text>
    <text x="600" y="65" text-anchor="middle" class="small-label white-text">Messages</text>
    <text x="600" y="82" text-anchor="middle" class="small-label white-text">Remote log</text>

    <!-- StateManager -->
    <rect x="750" y="0" width="200" height="100" class="manager-box" rx="5"/>
    <text x="850" y="28" text-anchor="middle" class="subtitle white-text">StateManager</text>
    <text x="850" y="48" text-anchor="middle" class="small-label white-text">Persistence</text>
    <text x="850" y="65" text-anchor="middle" class="small-label white-text">History</text>
    <text x="850" y="82" text-anchor="middle" class="small-label white-text">Config</text>

    <!-- ProgressManager -->
    <rect x="1000" y="0" width="200" height="100" class="manager-box" rx="5"/>
    <text x="1100" y="28" text-anchor="middle" class="subtitle white-text">ProgressManager</text>
    <text x="1100" y="48" text-anchor="middle" class="small-label white-text">Progress</text>
    <text x="1100" y="65" text-anchor="middle" class="small-label white-text">Threading</text>
    <text x="1100" y="82" text-anchor="middle" class="small-label white-text">Cancellation</text>
  </g>

  <!-- Path Polymorphism Layer -->
  <g transform="translate(660, 400)">
    <rect x="0" y="0" width="600" height="90" class="storage-box" rx="5"/>
    <text x="300" y="28" text-anchor="middle" class="subtitle white-text">Path (Polymorphic Interface)</text>
    <text x="300" y="45" text-anchor="middle" class="small-label white-text">(tfm_path.py) - PathImpl ABC</text>
    <text x="300" y="62" text-anchor="middle" class="small-label white-text">Unified interface for all storage types</text>
    <text x="300" y="78" text-anchor="middle" class="small-label white-text">Storage-agnostic operations</text>
  </g>

  <!-- Storage Implementations -->
  <g transform="translate(50, 570)">
    <!-- LocalPathImpl -->
    <rect x="0" y="0" width="250" height="90" class="storage-box" rx="5"/>
    <text x="125" y="25" text-anchor="middle" class="subtitle white-text">LocalPathImpl</text>
    <text x="125" y="42" text-anchor="middle" class="small-label white-text">Local filesystem</text>
    <text x="125" y="58" text-anchor="middle" class="small-label white-text">pathlib wrapper</text>
    <text x="125" y="74" text-anchor="middle" class="small-label white-text">Direct access</text>

    <!-- S3PathImpl -->
    <rect x="300" y="0" width="250" height="90" class="storage-box" rx="5"/>
    <text x="425" y="25" text-anchor="middle" class="subtitle white-text">S3PathImpl</text>
    <text x="425" y="42" text-anchor="middle" class="small-label white-text">AWS S3 storage</text>
    <text x="425" y="58" text-anchor="middle" class="small-label white-text">boto3 + caching</text>
    <text x="425" y="74" text-anchor="middle" class="small-label white-text">(tfm_s3.py)</text>

    <!-- ArchivePathImpl -->
    <rect x="600" y="0" width="250" height="90" class="storage-box" rx="5"/>
    <text x="725" y="25" text-anchor="middle" class="subtitle white-text">ArchivePathImpl</text>
    <text x="725" y="42" text-anchor="middle" class="small-label white-text">ZIP, TAR browse</text>
    <text x="725" y="58" text-anchor="middle" class="small-label white-text">Virtual dirs</text>
    <text x="725" y="74" text-anchor="middle" class="small-label white-text">(tfm_archive.py)</text>

    <!-- Future Storage -->
    <rect x="900" y="0" width="200" height="90" class="box" rx="5" stroke-dasharray="5,5"/>
    <text x="1000" y="30" text-anchor="middle" class="subtitle">Future</text>
    <text x="1000" y="50" text-anchor="middle" class="small-label">FTP, SFTP</text>
    <text x="1000" y="68" text-anchor="middle" class="small-label">Extensible</text>
  </g>

  <!-- TTK Library Layer -->
  <g transform="translate(1450, 240)">
    <rect x="0" y="0" width="300" height="100" class="ttk-box" rx="5"/>
    <text x="150" y="28" text-anchor="middle" class="subtitle white-text">TTK (Terminal Toolkit)</text>
    <text x="150" y="45" text-anchor="middle" class="small-label white-text">Standalone library (ttk/)</text>
    <text x="150" y="62" text-anchor="middle" class="small-label white-text">Renderer abstraction</text>
    <text x="150" y="78" text-anchor="middle" class="small-label white-text">Input event handling</text>
    <text x="150" y="94" text-anchor="middle" class="small-label white-text">Backend-agnostic API</text>
  </g>

  <!-- TTK Backends -->
  <g transform="translate(1300, 420)">
    <!-- Curses Backend -->
    <rect x="0" y="0" width="180" height="80" class="backend-box" rx="5"/>
    <text x="90" y="25" text-anchor="middle" class="subtitle white-text">Curses</text>
    <text x="90" y="42" text-anchor="middle" class="small-label white-text">Default backend</text>
    <text x="90" y="58" text-anchor="middle" class="small-label white-text">Cross-platform</text>
    <text x="90" y="74" text-anchor="middle" class="small-label white-text">Terminal UI</text>

    <!-- CoreGraphics Backend -->
    <rect x="200" y="0" width="180" height="80" class="backend-box" rx="5"/>
    <text x="290" y="25" text-anchor="middle" class="subtitle white-text">CoreGraphics</text>
    <text x="290" y="42" text-anchor="middle" class="small-label white-text">macOS native</text>
    <text x="290" y="58" text-anchor="middle" class="small-label white-text">GPU rendering</text>
    <text x="290" y="74" text-anchor="middle" class="small-label white-text">High performance</text>

    <!-- Future Backends -->
    <rect x="400" y="0" width="180" height="80" class="box" rx="5" stroke-dasharray="5,5"/>
    <text x="490" y="30" text-anchor="middle" class="subtitle">Future</text>
    <text x="490" y="50" text-anchor="middle" class="small-label">OpenGL, Vulkan</text>
    <text x="490" y="68" text-anchor="middle" class="small-label">Web, etc.</text>
  </g>

  <!-- Cache & Archive Support -->
  <g transform="translate(250, 720)">
    <rect x="0" y="0" width="200" height="70" class="util-box" rx="5"/>
    <text x="100" y="25" text-anchor="middle" class="subtitle white-text">S3Cache</text>
    <text x="100" y="42" text-anchor="middle" class="small-label white-text">TTL caching</text>
    <text x="100" y="58" text-anchor="middle" class="small-label white-text">Invalidation</text>

    <rect x="250" y="0" width="200" height="70" class="util-box" rx="5"/>
    <text x="350" y="25" text-anchor="middle" class="subtitle white-text">CacheManager</text>
    <text x="350" y="42" text-anchor="middle" class="small-label white-text">Multi-storage</text>
    <text x="350" y="58" text-anchor="middle" class="small-label white-text">cache control</text>

    <rect x="500" y="0" width="250" height="70" class="storage-box" rx="5"/>
    <text x="625" y="25" text-anchor="middle" class="subtitle white-text">ArchiveOperations</text>
    <text x="625" y="42" text-anchor="middle" class="small-label white-text">Extract, create</text>
    <text x="625" y="58" text-anchor="middle" class="small-label white-text">Cross-storage</text>
  </g>

  <!-- UI Components Layer -->
  <g transform="translate(50, 820)">
    <text x="550" y="0" text-anchor="middle" class="subtitle">UI Components</text>
    
    <rect x="0" y="15" width="150" height="65" class="ui-box" rx="5"/>
    <text x="75" y="38" text-anchor="middle" class="label white-text">ListDialog</text>
    <text x="75" y="54" text-anchor="middle" class="small-label white-text">Selection</text>
    <text x="75" y="70" text-anchor="middle" class="small-label white-text">Favorites</text>

    <rect x="165" y="15" width="150" height="65" class="ui-box" rx="5"/>
    <text x="240" y="38" text-anchor="middle" class="label white-text">SearchDialog</text>
    <text x="240" y="54" text-anchor="middle" class="small-label white-text">File search</text>
    <text x="240" y="70" text-anchor="middle" class="small-label white-text">Threaded</text>

    <rect x="330" y="15" width="150" height="65" class="ui-box" rx="5"/>
    <text x="405" y="38" text-anchor="middle" class="label white-text">InfoDialog</text>
    <text x="405" y="54" text-anchor="middle" class="small-label white-text">Metadata</text>
    <text x="405" y="70" text-anchor="middle" class="small-label white-text">Storage info</text>

    <rect x="495" y="15" width="150" height="65" class="ui-box" rx="5"/>
    <text x="570" y="38" text-anchor="middle" class="label white-text">TextViewer</text>
    <text x="570" y="54" text-anchor="middle" class="small-label white-text">File view</text>
    <text x="570" y="70" text-anchor="middle" class="small-label white-text">Search</text>

    <rect x="660" y="15" width="150" height="65" class="ui-box" rx="5"/>
    <text x="735" y="38" text-anchor="middle" class="label white-text">BatchRename</text>
    <text x="735" y="54" text-anchor="middle" class="small-label white-text">Bulk ops</text>
    <text x="735" y="70" text-anchor="middle" class="small-label white-text">Patterns</text>

    <rect x="825" y="15" width="150" height="65" class="ui-box" rx="5"/>
    <text x="900" y="38" text-anchor="middle" class="label white-text">JumpDialog</text>
    <text x="900" y="54" text-anchor="middle" class="small-label white-text">Quick nav</text>
    <text x="900" y="70" text-anchor="middle" class="small-label white-text">Fuzzy match</text>
  </g>

  <!-- Utility Components -->
  <g transform="translate(1150, 820)">
    <text x="320" y="0" text-anchor="middle" class="subtitle">Utilities</text>
    
    <rect x="0" y="15" width="150" height="65" class="util-box" rx="5"/>
    <text x="75" y="38" text-anchor="middle" class="label white-text">WideChar</text>
    <text x="75" y="54" text-anchor="middle" class="small-label white-text">Unicode</text>
    <text x="75" y="70" text-anchor="middle" class="small-label white-text">Display</text>

    <rect x="165" y="15" width="150" height="65" class="util-box" rx="5"/>
    <text x="240" y="38" text-anchor="middle" class="label white-text">KeyBindings</text>
    <text x="240" y="54" text-anchor="middle" class="small-label white-text">Keyboard</text>
    <text x="240" y="70" text-anchor="middle" class="small-label white-text">Actions</text>

    <rect x="330" y="15" width="150" height="65" class="util-box" rx="5"/>
    <text x="405" y="38" text-anchor="middle" class="label white-text">Colors</text>
    <text x="405" y="54" text-anchor="middle" class="small-label white-text">Themes</text>
    <text x="405" y="70" text-anchor="middle" class="small-label white-text">Schemes</text>

    <rect x="495" y="15" width="150" height="65" class="util-box" rx="5"/>
    <text x="570" y="38" text-anchor="middle" class="label white-text">Config</text>
    <text x="570" y="54" text-anchor="middle" class="small-label white-text">Settings</text>
    <text x="570" y="70" text-anchor="middle" class="small-label white-text">User prefs</text>
  </g>

  <!-- External Systems -->
  <g transform="translate(50, 950)">
    <text x="900" y="0" text-anchor="middle" class="subtitle">External Systems</text>
    
    <rect x="0" y="15" width="150" height="55" class="box" rx="5"/>
    <text x="75" y="38" text-anchor="middle" class="label">AWS S3</text>
    <text x="75" y="55" text-anchor="middle" class="small-label">Cloud storage</text>

    <rect x="165" y="15" width="150" height="55" class="box" rx="5"/>
    <text x="240" y="38" text-anchor="middle" class="label">Local FS</text>
    <text x="240" y="55" text-anchor="middle" class="small-label">File system</text>

    <rect x="330" y="15" width="150" height="55" class="box" rx="5"/>
    <text x="405" y="38" text-anchor="middle" class="label">Archives</text>
    <text x="405" y="55" text-anchor="middle" class="small-label">ZIP, TAR</text>

    <rect x="495" y="15" width="150" height="55" class="box" rx="5"/>
    <text x="570" y="38" text-anchor="middle" class="label">Terminal</text>
    <text x="570" y="55" text-anchor="middle" class="small-label">Display</text>

    <rect x="660" y="15" width="150" height="55" class="box" rx="5"/>
    <text x="735" y="38" text-anchor="middle" class="label">External Tools</text>
    <text x="735" y="55" text-anchor="middle" class="small-label">Editors</text>

    <rect x="825" y="15" width="150" height="55" class="box" rx="5"/>
    <text x="900" y="38" text-anchor="middle" class="label">Config Files</text>
    <text x="900" y="55" text-anchor="middle" class="small-label">~/.tfm/</text>
  </g>

  <!-- Key Architectural Patterns -->
  <g transform="translate(1150, 950)">
    <text x="320" y="0" text-anchor="middle" class="subtitle">Key Patterns</text>
    
    <rect x="0" y="15" width="200" height="100" class="box" rx="5"/>
    <text x="100" y="35" text-anchor="middle" class="label">Path Polymorphism</text>
    <text x="100" y="52" text-anchor="middle" class="small-label">Unified storage API</text>
    <text x="100" y="68" text-anchor="middle" class="small-label">Extensible PathImpl</text>
    <text x="100" y="84" text-anchor="middle" class="small-label">Storage-agnostic</text>
    <text x="100" y="100" text-anchor="middle" class="small-label">No conditionals</text>

    <rect x="220" y="15" width="200" height="100" class="box" rx="5"/>
    <text x="320" y="35" text-anchor="middle" class="label">Manager Pattern</text>
    <text x="320" y="52" text-anchor="middle" class="small-label">Separation of concerns</text>
    <text x="320" y="68" text-anchor="middle" class="small-label">Modular components</text>
    <text x="320" y="84" text-anchor="middle" class="small-label">State management</text>
    <text x="320" y="100" text-anchor="middle" class="small-label">Progress tracking</text>

    <rect x="440" y="15" width="200" height="100" class="box" rx="5"/>
    <text x="540" y="35" text-anchor="middle" class="label">TTK Abstraction</text>
    <text x="540" y="52" text-anchor="middle" class="small-label">Backend-agnostic</text>
    <text x="540" y="68" text-anchor="middle" class="small-label">Multiple renderers</text>
    <text x="540" y="84" text-anchor="middle" class="small-label">Pluggable backends</text>
    <text x="540" y="100" text-anchor="middle" class="small-label">Performance options</text>
  </g>

  <!-- Data Flow -->
  <g transform="translate(50, 1030)">
    <text x="900" y="0" text-anchor="middle" class="subtitle">Data Flow</text>
    
    <line x1="0" y1="20" x2="80" y2="20" class="arrow"/>
    <text x="90" y="25" class="small-label">Control flow</text>
    
    <line x1="200" y1="20" x2="280" y2="20" class="data-arrow"/>
    <text x="290" y="25" class="small-label">Data flow</text>
    
    <text x="900" y="45" text-anchor="middle" class="small-label">User Input → FileManager → Managers → Path → Storage → External Systems</text>
  </g>
</svg>
