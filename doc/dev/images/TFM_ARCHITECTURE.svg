<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1400 1600" width="1400" height="1600">
  <defs>
    <style>
      .title { font: bold 24px sans-serif; fill: #2c3e50; }
      .subtitle { font: bold 18px sans-serif; fill: #34495e; }
      .label { font: 14px sans-serif; fill: #2c3e50; }
      .small-label { font: 12px sans-serif; fill: #555; }
      .box { fill: #ecf0f1; stroke: #34495e; stroke-width: 2; }
      .core-box { fill: #3498db; stroke: #2980b9; stroke-width: 2; }
      .storage-box { fill: #e74c3c; stroke: #c0392b; stroke-width: 2; }
      .ui-box { fill: #2ecc71; stroke: #27ae60; stroke-width: 2; }
      .manager-box { fill: #f39c12; stroke: #d68910; stroke-width: 2; }
      .util-box { fill: #9b59b6; stroke: #8e44ad; stroke-width: 2; }
      .arrow { stroke: #7fb3d5; stroke-width: 2; fill: none; marker-end: url(#arrowhead); opacity: 0.7; }
      .data-arrow { stroke: #e74c3c; stroke-width: 2; fill: none; marker-end: url(#arrowhead-red); stroke-dasharray: 5,5; opacity: 0.7; }
      .white-text { fill: white; }
    </style>
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#7fb3d5" opacity="0.7" />
    </marker>
    <marker id="arrowhead-red" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#e74c3c" />
    </marker>
  </defs>

  <!-- ========== ARROWS LAYER (BACKGROUND) ========== -->
  <!-- Arrows showing relationships -->
  
  <!-- FileManager (550,120 + 300x80) center bottom: (700, 200) to Managers top centers -->
  <!-- PaneManager (100,250 + 200x100) top center: (200, 250) -->
  <path d="M 700 200 L 200 250" class="arrow"/>
  <!-- FileOperations (350,250 + 200x100) top center: (450, 250) -->
  <path d="M 700 200 L 450 250" class="arrow"/>
  <!-- LogManager (600,250 + 200x100) top center: (700, 250) -->
  <path d="M 700 200 L 700 250" class="arrow"/>
  <!-- StateManager (850,250 + 200x100) top center: (950, 250) -->
  <path d="M 700 200 L 950 250" class="arrow"/>
  <!-- ProgressManager (1100,250 + 200x100) top center: (1200, 250) -->
  <path d="M 700 200 L 1200 250" class="arrow"/>

  <!-- FileOperations (450, 350) bottom center to Path (700, 400) top center -->
  <path d="M 450 350 L 700 400" class="arrow"/>
  <!-- LogManager (700, 350) bottom center to Path (700, 400) top center -->
  <path d="M 700 350 L 700 400" class="arrow"/>

  <!-- Path (400,400 + 600x120) bottom center: (700, 520) to Storage Implementations top centers -->
  <!-- LocalPathImpl (100,570 + 250x120) top center: (225, 570) -->
  <path d="M 700 520 L 225 570" class="arrow"/>
  <!-- S3PathImpl (400,570 + 250x120) top center: (525, 570) -->
  <path d="M 700 520 L 525 570" class="arrow"/>
  <!-- ArchivePathImpl (700,570 + 250x120) top center: (825, 570) -->
  <path d="M 700 520 L 825 570" class="arrow"/>

  <!-- S3PathImpl (525, 690) bottom center to S3Cache (350,740 + 200x80) top center: (450, 740) -->
  <path d="M 525 690 L 450 740" class="data-arrow"/>

  <!-- ArchivePathImpl (825, 690) bottom center to ArchiveOperations (600,740 + 250x80) top center: (725, 740) -->
  <path d="M 825 690 L 725 740" class="arrow"/>

  <!-- Storage Implementations bottom centers to External Systems top centers -->
  <!-- LocalPathImpl (225, 690) to Local FS (300,1150 + 180x60) top center: (390, 1150) -->
  <path d="M 225 690 L 390 1150" class="data-arrow"/>
  <!-- S3PathImpl (525, 690) to AWS S3 (100,1150 + 180x60) top center: (190, 1150) -->
  <path d="M 525 690 L 190 1150" class="data-arrow"/>
  <!-- ArchivePathImpl (825, 690) to Archives (500,1150 + 180x60) top center: (590, 1150) -->
  <path d="M 825 690 L 590 1150" class="data-arrow"/>

  <!-- FileManager (550, 160) left edge center to SearchDialog (300,890 + 180x80) top center: (390, 890) -->
  <path d="M 550 160 L 390 890" class="arrow"/>
  <!-- FileManager (700, 200) bottom center to TextViewer (700,890 + 180x80) top center: (790, 890) -->
  <path d="M 700 200 L 790 890" class="arrow"/>

  <!-- FileManager (850, 160) right edge center to Curses (700,1150 + 180x60) top center: (790, 1150) -->
  <path d="M 850 160 L 790 1150" class="arrow"/>

  <!-- ========== CONTENT LAYER (FOREGROUND) ========== -->
  <!-- Title -->
  <text x="700" y="40" text-anchor="middle" class="title">TFM (TUI File Manager) Architecture</text>
  
  <!-- Legend -->
  <g transform="translate(50, 60)">
    <text x="0" y="0" class="small-label">Legend:</text>
    <rect x="0" y="10" width="60" height="20" class="core-box"/>
    <text x="70" y="25" class="small-label">Core</text>
    <rect x="150" y="10" width="60" height="20" class="storage-box"/>
    <text x="220" y="25" class="small-label">Storage</text>
    <rect x="300" y="10" width="60" height="20" class="ui-box"/>
    <text x="370" y="25" class="small-label">UI Components</text>
    <rect x="480" y="10" width="60" height="20" class="manager-box"/>
    <text x="550" y="25" class="small-label">Managers</text>
    <rect x="650" y="10" width="60" height="20" class="util-box"/>
    <text x="720" y="25" class="small-label">Utilities</text>
  </g>

  <!-- Main Application Layer -->
  <g transform="translate(550, 120)">
    <rect x="0" y="0" width="300" height="80" class="core-box" rx="5"/>
    <text x="150" y="30" text-anchor="middle" class="subtitle white-text">FileManager</text>
    <text x="150" y="50" text-anchor="middle" class="small-label white-text">(tfm_main.py)</text>
    <text x="150" y="70" text-anchor="middle" class="small-label white-text">Main application controller</text>
  </g>

  <!-- Core Managers Layer -->
  <g transform="translate(100, 250)">
    <!-- PaneManager -->
    <rect x="0" y="0" width="200" height="100" class="manager-box" rx="5"/>
    <text x="100" y="30" text-anchor="middle" class="subtitle white-text">PaneManager</text>
    <text x="100" y="50" text-anchor="middle" class="small-label white-text">Dual pane management</text>
    <text x="100" y="70" text-anchor="middle" class="small-label white-text">Navigation &amp; history</text>
    <text x="100" y="90" text-anchor="middle" class="small-label white-text">Cursor positioning</text>

    <!-- FileOperations -->
    <rect x="250" y="0" width="200" height="100" class="manager-box" rx="5"/>
    <text x="350" y="30" text-anchor="middle" class="subtitle white-text">FileOperations</text>
    <text x="350" y="50" text-anchor="middle" class="small-label white-text">File operations</text>
    <text x="350" y="70" text-anchor="middle" class="small-label white-text">Copy, move, delete</text>
    <text x="350" y="90" text-anchor="middle" class="small-label white-text">Selection management</text>

    <!-- LogManager -->
    <rect x="500" y="0" width="200" height="100" class="manager-box" rx="5"/>
    <text x="600" y="30" text-anchor="middle" class="subtitle white-text">LogManager</text>
    <text x="600" y="50" text-anchor="middle" class="small-label white-text">Logging system</text>
    <text x="600" y="70" text-anchor="middle" class="small-label white-text">Message display</text>
    <text x="600" y="90" text-anchor="middle" class="small-label white-text">Remote logging</text>

    <!-- StateManager -->
    <rect x="750" y="0" width="200" height="100" class="manager-box" rx="5"/>
    <text x="850" y="30" text-anchor="middle" class="subtitle white-text">StateManager</text>
    <text x="850" y="50" text-anchor="middle" class="small-label white-text">State persistence</text>
    <text x="850" y="70" text-anchor="middle" class="small-label white-text">Cursor history</text>
    <text x="850" y="90" text-anchor="middle" class="small-label white-text">Configuration</text>

    <!-- ProgressManager -->
    <rect x="1000" y="0" width="200" height="100" class="manager-box" rx="5"/>
    <text x="1100" y="30" text-anchor="middle" class="subtitle white-text">ProgressManager</text>
    <text x="1100" y="50" text-anchor="middle" class="small-label white-text">Operation progress</text>
    <text x="1100" y="70" text-anchor="middle" class="small-label white-text">Threading support</text>
    <text x="1100" y="90" text-anchor="middle" class="small-label white-text">Cancellation</text>
  </g>

  <!-- Path Polymorphism Layer (Core Storage Abstraction) -->
  <g transform="translate(400, 400)">
    <rect x="0" y="0" width="600" height="120" class="storage-box" rx="5"/>
    <text x="300" y="30" text-anchor="middle" class="subtitle white-text">Path (Polymorphic Interface)</text>
    <text x="300" y="50" text-anchor="middle" class="small-label white-text">(tfm_path.py)</text>
    <text x="300" y="70" text-anchor="middle" class="small-label white-text">Unified path interface for all storage types</text>
    <text x="300" y="90" text-anchor="middle" class="small-label white-text">PathImpl abstract base class</text>
    <text x="300" y="110" text-anchor="middle" class="small-label white-text">Storage-agnostic operations</text>
  </g>

  <!-- Storage Implementations -->
  <g transform="translate(100, 570)">
    <!-- LocalPathImpl -->
    <rect x="0" y="0" width="250" height="120" class="storage-box" rx="5"/>
    <text x="125" y="30" text-anchor="middle" class="subtitle white-text">LocalPathImpl</text>
    <text x="125" y="50" text-anchor="middle" class="small-label white-text">Local filesystem</text>
    <text x="125" y="70" text-anchor="middle" class="small-label white-text">pathlib wrapper</text>
    <text x="125" y="90" text-anchor="middle" class="small-label white-text">Direct file access</text>
    <text x="125" y="110" text-anchor="middle" class="small-label white-text">Streaming reads</text>

    <!-- S3PathImpl -->
    <rect x="300" y="0" width="250" height="120" class="storage-box" rx="5"/>
    <text x="425" y="30" text-anchor="middle" class="subtitle white-text">S3PathImpl</text>
    <text x="425" y="50" text-anchor="middle" class="small-label white-text">(tfm_s3.py)</text>
    <text x="425" y="70" text-anchor="middle" class="small-label white-text">AWS S3 storage</text>
    <text x="425" y="90" text-anchor="middle" class="small-label white-text">boto3 integration</text>
    <text x="425" y="110" text-anchor="middle" class="small-label white-text">Caching layer</text>

    <!-- ArchivePathImpl -->
    <rect x="600" y="0" width="250" height="120" class="storage-box" rx="5"/>
    <text x="725" y="30" text-anchor="middle" class="subtitle white-text">ArchivePathImpl</text>
    <text x="725" y="50" text-anchor="middle" class="small-label white-text">(tfm_archive.py)</text>
    <text x="725" y="70" text-anchor="middle" class="small-label white-text">Archive browsing</text>
    <text x="725" y="90" text-anchor="middle" class="small-label white-text">ZIP, TAR support</text>
    <text x="725" y="110" text-anchor="middle" class="small-label white-text">Virtual directories</text>

    <!-- Future Storage -->
    <rect x="900" y="0" width="250" height="120" class="box" rx="5" stroke-dasharray="5,5"/>
    <text x="1025" y="30" text-anchor="middle" class="subtitle">Future Storage</text>
    <text x="1025" y="60" text-anchor="middle" class="small-label">FTP, SFTP, etc.</text>
    <text x="1025" y="80" text-anchor="middle" class="small-label">Extensible via</text>
    <text x="1025" y="100" text-anchor="middle" class="small-label">PathImpl interface</text>
  </g>

  <!-- Archive Support Components -->
  <g transform="translate(600, 740)">
    <rect x="0" y="0" width="250" height="80" class="storage-box" rx="5"/>
    <text x="125" y="30" text-anchor="middle" class="subtitle white-text">ArchiveOperations</text>
    <text x="125" y="50" text-anchor="middle" class="small-label white-text">Extract, create archives</text>
    <text x="125" y="70" text-anchor="middle" class="small-label white-text">Cross-storage support</text>
  </g>

  <!-- Cache Management -->
  <g transform="translate(100, 740)">
    <rect x="0" y="0" width="200" height="80" class="util-box" rx="5"/>
    <text x="100" y="30" text-anchor="middle" class="subtitle white-text">CacheManager</text>
    <text x="100" y="50" text-anchor="middle" class="small-label white-text">S3 caching</text>
    <text x="100" y="70" text-anchor="middle" class="small-label white-text">Archive caching</text>

    <rect x="250" y="0" width="200" height="80" class="util-box" rx="5"/>
    <text x="350" y="30" text-anchor="middle" class="subtitle white-text">S3Cache</text>
    <text x="350" y="50" text-anchor="middle" class="small-label white-text">TTL-based caching</text>
    <text x="350" y="70" text-anchor="middle" class="small-label white-text">Invalidation</text>
  </g>

  <!-- UI Components Layer -->
  <g transform="translate(100, 870)">
    <text x="600" y="0" text-anchor="middle" class="subtitle">UI Components</text>
    
    <!-- Dialog Components -->
    <rect x="0" y="20" width="180" height="80" class="ui-box" rx="5"/>
    <text x="90" y="45" text-anchor="middle" class="label white-text">ListDialog</text>
    <text x="90" y="65" text-anchor="middle" class="small-label white-text">File selection</text>
    <text x="90" y="85" text-anchor="middle" class="small-label white-text">Favorites, drives</text>

    <rect x="200" y="20" width="180" height="80" class="ui-box" rx="5"/>
    <text x="290" y="45" text-anchor="middle" class="label white-text">SearchDialog</text>
    <text x="290" y="65" text-anchor="middle" class="small-label white-text">File search</text>
    <text x="290" y="85" text-anchor="middle" class="small-label white-text">Threaded search</text>

    <rect x="400" y="20" width="180" height="80" class="ui-box" rx="5"/>
    <text x="490" y="45" text-anchor="middle" class="label white-text">InfoDialog</text>
    <text x="490" y="65" text-anchor="middle" class="small-label white-text">File metadata</text>
    <text x="490" y="85" text-anchor="middle" class="small-label white-text">Storage info</text>

    <rect x="600" y="20" width="180" height="80" class="ui-box" rx="5"/>
    <text x="690" y="45" text-anchor="middle" class="label white-text">TextViewer</text>
    <text x="690" y="65" text-anchor="middle" class="small-label white-text">File viewing</text>
    <text x="690" y="85" text-anchor="middle" class="small-label white-text">Search in file</text>

    <rect x="800" y="20" width="180" height="80" class="ui-box" rx="5"/>
    <text x="890" y="45" text-anchor="middle" class="label white-text">BatchRename</text>
    <text x="890" y="65" text-anchor="middle" class="small-label white-text">Bulk renaming</text>
    <text x="890" y="85" text-anchor="middle" class="small-label white-text">Pattern matching</text>

    <rect x="1000" y="20" width="180" height="80" class="ui-box" rx="5"/>
    <text x="1090" y="45" text-anchor="middle" class="label white-text">JumpDialog</text>
    <text x="1090" y="65" text-anchor="middle" class="small-label white-text">Quick navigation</text>
    <text x="1090" y="85" text-anchor="middle" class="small-label white-text">Fuzzy matching</text>
  </g>

  <!-- Utility Components -->
  <g transform="translate(100, 1000)">
    <text x="600" y="0" text-anchor="middle" class="subtitle">Utilities &amp; Support</text>
    
    <rect x="0" y="20" width="200" height="70" class="util-box" rx="5"/>
    <text x="100" y="45" text-anchor="middle" class="label white-text">WideCharUtils</text>
    <text x="100" y="65" text-anchor="middle" class="small-label white-text">Unicode support</text>
    <text x="100" y="85" text-anchor="middle" class="small-label white-text">Display width</text>

    <rect x="220" y="20" width="200" height="70" class="util-box" rx="5"/>
    <text x="320" y="45" text-anchor="middle" class="label white-text">KeyBindings</text>
    <text x="320" y="65" text-anchor="middle" class="small-label white-text">Keyboard config</text>
    <text x="320" y="85" text-anchor="middle" class="small-label white-text">Action mapping</text>

    <rect x="440" y="20" width="200" height="70" class="util-box" rx="5"/>
    <text x="540" y="45" text-anchor="middle" class="label white-text">Colors</text>
    <text x="540" y="65" text-anchor="middle" class="small-label white-text">Color schemes</text>
    <text x="540" y="85" text-anchor="middle" class="small-label white-text">Theme support</text>

    <rect x="660" y="20" width="200" height="70" class="util-box" rx="5"/>
    <text x="760" y="45" text-anchor="middle" class="label white-text">Config</text>
    <text x="760" y="65" text-anchor="middle" class="small-label white-text">Configuration</text>
    <text x="760" y="85" text-anchor="middle" class="small-label white-text">User settings</text>

    <rect x="880" y="20" width="200" height="70" class="util-box" rx="5"/>
    <text x="980" y="45" text-anchor="middle" class="label white-text">ExternalPrograms</text>
    <text x="980" y="65" text-anchor="middle" class="small-label white-text">External tools</text>
    <text x="980" y="85" text-anchor="middle" class="small-label white-text">Integration</text>
  </g>

  <!-- External Systems -->
  <g transform="translate(100, 1130)">
    <text x="600" y="0" text-anchor="middle" class="subtitle">External Systems</text>
    
    <rect x="0" y="20" width="180" height="60" class="box" rx="5"/>
    <text x="90" y="45" text-anchor="middle" class="label">AWS S3</text>
    <text x="90" y="65" text-anchor="middle" class="small-label">Cloud storage</text>

    <rect x="200" y="20" width="180" height="60" class="box" rx="5"/>
    <text x="290" y="45" text-anchor="middle" class="label">Local FS</text>
    <text x="290" y="65" text-anchor="middle" class="small-label">File system</text>

    <rect x="400" y="20" width="180" height="60" class="box" rx="5"/>
    <text x="490" y="45" text-anchor="middle" class="label">Archives</text>
    <text x="490" y="65" text-anchor="middle" class="small-label">ZIP, TAR files</text>

    <rect x="600" y="20" width="180" height="60" class="box" rx="5"/>
    <text x="690" y="45" text-anchor="middle" class="label">Curses</text>
    <text x="690" y="65" text-anchor="middle" class="small-label">Terminal UI</text>

    <rect x="800" y="20" width="180" height="60" class="box" rx="5"/>
    <text x="890" y="45" text-anchor="middle" class="label">External Tools</text>
    <text x="890" y="65" text-anchor="middle" class="small-label">Editors, viewers</text>

    <rect x="1000" y="20" width="180" height="60" class="box" rx="5"/>
    <text x="1090" y="45" text-anchor="middle" class="label">Config Files</text>
    <text x="1090" y="65" text-anchor="middle" class="small-label">~/.tfm/</text>
  </g>

  <!-- Key Architectural Patterns -->
  <g transform="translate(100, 1250)">
    <text x="600" y="0" text-anchor="middle" class="subtitle">Key Architectural Patterns</text>
    
    <rect x="0" y="20" width="380" height="120" class="box" rx="5"/>
    <text x="190" y="45" text-anchor="middle" class="label">Path Polymorphism</text>
    <text x="190" y="65" text-anchor="middle" class="small-label">• Unified interface for all storage types</text>
    <text x="190" y="85" text-anchor="middle" class="small-label">• Storage-agnostic operations</text>
    <text x="190" y="105" text-anchor="middle" class="small-label">• Extensible via PathImpl</text>
    <text x="190" y="125" text-anchor="middle" class="small-label">• No storage conditionals in UI code</text>

    <rect x="410" y="20" width="380" height="120" class="box" rx="5"/>
    <text x="600" y="45" text-anchor="middle" class="label">Manager Pattern</text>
    <text x="600" y="65" text-anchor="middle" class="small-label">• Separation of concerns</text>
    <text x="600" y="85" text-anchor="middle" class="small-label">• Modular components</text>
    <text x="600" y="105" text-anchor="middle" class="small-label">• State management</text>
    <text x="600" y="125" text-anchor="middle" class="small-label">• Progress tracking</text>

    <rect x="820" y="20" width="380" height="120" class="box" rx="5"/>
    <text x="1010" y="45" text-anchor="middle" class="label">Caching Strategy</text>
    <text x="1010" y="65" text-anchor="middle" class="small-label">• TTL-based caching</text>
    <text x="1010" y="85" text-anchor="middle" class="small-label">• Lazy loading</text>
    <text x="1010" y="105" text-anchor="middle" class="small-label">• Smart invalidation</text>
    <text x="1010" y="125" text-anchor="middle" class="small-label">• Performance optimization</text>
  </g>

  <!-- Data Flow Indicators -->
  <g transform="translate(100, 1420)">
    <text x="600" y="0" text-anchor="middle" class="subtitle">Data Flow</text>
    
    <line x1="0" y1="30" x2="100" y2="30" class="arrow"/>
    <text x="110" y="35" class="small-label">Control flow</text>
    
    <line x1="250" y1="30" x2="350" y2="30" class="data-arrow"/>
    <text x="360" y="35" class="small-label">Data flow</text>
    
    <text x="0" y="70" class="small-label">User Input → FileManager → Managers → Path → Storage Implementations → External Systems</text>
    <text x="0" y="95" class="small-label">Storage Data → Path → Managers → UI Components → Display</text>
  </g>
</svg>
