<svg viewBox="0 0 1920 1080" xmlns="http://www.w3.org/2000/svg">
  <!-- Background -->
  <rect width="1920" height="1080" fill="#1e1e1e"/>
  
  <!-- Title -->
  <text x="960" y="55" font-family="Arial, sans-serif" font-size="42" font-weight="bold" fill="#ffffff" text-anchor="middle">
    Task System Architecture
  </text>
  
  <!-- Subtitle -->
  <text x="960" y="95" font-family="Arial, sans-serif" font-size="19" fill="#cccccc" text-anchor="middle">
    State Machine Framework for Long-Running Operations with UI Interaction
  </text>
  
  <!-- Left Column: Base Task and Implementations -->
  <text x="70" y="140" font-family="Arial, sans-serif" font-size="26" font-weight="bold" fill="#4ec9b0">
    Abstract Base Class
  </text>
  
  <rect x="70" y="155" width="520" height="135" fill="#2d2d30" stroke="#569cd6" stroke-width="3" rx="8"/>
  <text x="330" y="182" font-family="Arial, sans-serif" font-size="20" font-weight="bold" fill="#569cd6" text-anchor="middle">
    BaseTask (ABC)
  </text>
  <text x="90" y="208" font-family="Arial, sans-serif" font-size="15" fill="#d4d4d4">
    • Abstract methods: start(), cancel(), is_active(), get_state()
  </text>
  <text x="90" y="230" font-family="Arial, sans-serif" font-size="15" fill="#d4d4d4">
    • Lifecycle hooks: on_state_enter(), on_state_exit()
  </text>
  <text x="90" y="252" font-family="Arial, sans-serif" font-size="15" fill="#d4d4d4">
    • Holds reference to FileManager for UI interactions
  </text>
  <text x="90" y="274" font-family="Arial, sans-serif" font-size="15" fill="#d4d4d4">
    • Provides framework for complex workflows
  </text>
  
  <!-- Concrete Implementations -->
  <text x="70" y="325" font-family="Arial, sans-serif" font-size="26" font-weight="bold" fill="#4ec9b0">
    Concrete Task Implementations
  </text>
  
  <!-- FileOperationTask -->
  <rect x="70" y="340" width="480" height="155" fill="#2d2d30" stroke="#ce9178" stroke-width="2" rx="8"/>
  <text x="310" y="365" font-family="Arial, sans-serif" font-size="19" font-weight="bold" fill="#ce9178" text-anchor="middle">
    FileOperationTask
  </text>
  <text x="90" y="390" font-family="Arial, sans-serif" font-size="14" fill="#d4d4d4">
    • Operations: copy, move, delete
  </text>
  <text x="90" y="411" font-family="Arial, sans-serif" font-size="14" fill="#d4d4d4">
    • Delegates UI → FileOperationUI
  </text>
  <text x="90" y="432" font-family="Arial, sans-serif" font-size="14" fill="#d4d4d4">
    • Delegates I/O → FileOperationExecutor
  </text>
  <text x="90" y="453" font-family="Arial, sans-serif" font-size="14" fill="#d4d4d4">
    • Manages OperationContext state
  </text>
  <text x="90" y="474" font-family="Arial, sans-serif" font-size="14" fill="#d4d4d4">
    • Conflict resolution with rename support
  </text>
  
  <!-- ArchiveOperationTask -->
  <rect x="70" y="510" width="480" height="155" fill="#2d2d30" stroke="#ce9178" stroke-width="2" rx="8"/>
  <text x="310" y="535" font-family="Arial, sans-serif" font-size="19" font-weight="bold" fill="#ce9178" text-anchor="middle">
    ArchiveOperationTask
  </text>
  <text x="90" y="560" font-family="Arial, sans-serif" font-size="14" fill="#d4d4d4">
    • Operations: create, extract
  </text>
  <text x="90" y="581" font-family="Arial, sans-serif" font-size="14" fill="#d4d4d4">
    • Delegates UI → ArchiveOperationUI
  </text>
  <text x="90" y="602" font-family="Arial, sans-serif" font-size="14" fill="#d4d4d4">
    • Delegates I/O → ArchiveOperationExecutor
  </text>
  <text x="90" y="623" font-family="Arial, sans-serif" font-size="14" fill="#d4d4d4">
    • Manages ArchiveOperationContext
  </text>
  <text x="90" y="644" font-family="Arial, sans-serif" font-size="14" fill="#d4d4d4">
    • Format support: tar, tar.gz, zip, etc.
  </text>
  
  <!-- State Machine -->
  <text x="70" y="710" font-family="Arial, sans-serif" font-size="26" font-weight="bold" fill="#4ec9b0">
    State Machine (6 States)
  </text>
  
  <!-- States - Compact layout -->
  <rect x="70" y="725" width="155" height="78" fill="#2d2d30" stroke="#dcdcaa" stroke-width="2" rx="6"/>
  <text x="147" y="748" font-family="Arial, sans-serif" font-size="17" font-weight="bold" fill="#dcdcaa" text-anchor="middle">
    IDLE
  </text>
  <text x="147" y="770" font-family="Arial, sans-serif" font-size="13" fill="#d4d4d4" text-anchor="middle">
    No operation
  </text>
  <text x="147" y="788" font-family="Arial, sans-serif" font-size="13" fill="#d4d4d4" text-anchor="middle">
    in progress
  </text>
  
  <rect x="245" y="725" width="155" height="78" fill="#2d2d30" stroke="#dcdcaa" stroke-width="2" rx="6"/>
  <text x="322" y="748" font-family="Arial, sans-serif" font-size="17" font-weight="bold" fill="#dcdcaa" text-anchor="middle">
    CONFIRMING
  </text>
  <text x="322" y="770" font-family="Arial, sans-serif" font-size="13" fill="#d4d4d4" text-anchor="middle">
    Waiting for user
  </text>
  <text x="322" y="788" font-family="Arial, sans-serif" font-size="13" fill="#d4d4d4" text-anchor="middle">
    confirmation
  </text>
  
  <rect x="420" y="725" width="175" height="78" fill="#2d2d30" stroke="#dcdcaa" stroke-width="2" rx="6"/>
  <text x="507" y="745" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#dcdcaa" text-anchor="middle">
    CHECKING_
  </text>
  <text x="507" y="763" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#dcdcaa" text-anchor="middle">
    CONFLICTS
  </text>
  <text x="507" y="788" font-family="Arial, sans-serif" font-size="12" fill="#d4d4d4" text-anchor="middle">
    Detecting conflicts
  </text>
  
  <rect x="615" y="725" width="175" height="78" fill="#2d2d30" stroke="#dcdcaa" stroke-width="2" rx="6"/>
  <text x="702" y="745" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#dcdcaa" text-anchor="middle">
    RESOLVING_
  </text>
  <text x="702" y="763" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#dcdcaa" text-anchor="middle">
    CONFLICT
  </text>
  <text x="702" y="788" font-family="Arial, sans-serif" font-size="12" fill="#d4d4d4" text-anchor="middle">
    User resolving
  </text>
  
  <rect x="810" y="725" width="155" height="78" fill="#2d2d30" stroke="#dcdcaa" stroke-width="2" rx="6"/>
  <text x="887" y="748" font-family="Arial, sans-serif" font-size="17" font-weight="bold" fill="#dcdcaa" text-anchor="middle">
    EXECUTING
  </text>
  <text x="887" y="770" font-family="Arial, sans-serif" font-size="13" fill="#d4d4d4" text-anchor="middle">
    Background
  </text>
  <text x="887" y="788" font-family="Arial, sans-serif" font-size="13" fill="#d4d4d4" text-anchor="middle">
    thread running
  </text>
  
  <rect x="985" y="725" width="155" height="78" fill="#2d2d30" stroke="#dcdcaa" stroke-width="2" rx="6"/>
  <text x="1062" y="748" font-family="Arial, sans-serif" font-size="17" font-weight="bold" fill="#dcdcaa" text-anchor="middle">
    COMPLETED
  </text>
  <text x="1062" y="770" font-family="Arial, sans-serif" font-size="13" fill="#d4d4d4" text-anchor="middle">
    Operation
  </text>
  <text x="1062" y="788" font-family="Arial, sans-serif" font-size="13" fill="#d4d4d4" text-anchor="middle">
    finished
  </text>
  
  <!-- State transitions arrows -->
  <defs>
    <marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#dcdcaa"/>
    </marker>
  </defs>
  
  <line x1="225" y1="764" x2="245" y2="764" stroke="#dcdcaa" stroke-width="2" marker-end="url(#arrow)"/>
  <line x1="400" y1="764" x2="420" y2="764" stroke="#dcdcaa" stroke-width="2" marker-end="url(#arrow)"/>
  <line x1="595" y1="764" x2="615" y2="764" stroke="#dcdcaa" stroke-width="2" marker-end="url(#arrow)"/>
  <line x1="790" y1="764" x2="810" y2="764" stroke="#dcdcaa" stroke-width="2" marker-end="url(#arrow)"/>
  <line x1="965" y1="764" x2="985" y2="764" stroke="#dcdcaa" stroke-width="2" marker-end="url(#arrow)"/>
  
  <!-- Back to IDLE -->
  <path d="M 1062 803 Q 1062 835, 147 835 Q 147 813, 147 803" stroke="#dcdcaa" stroke-width="2" fill="none" marker-end="url(#arrow)"/>
  
  <!-- Context Data Structures -->
  <text x="70" y="870" font-family="Arial, sans-serif" font-size="24" font-weight="bold" fill="#4ec9b0">
    Operation Context (State Container)
  </text>
  
  <!-- OperationContext -->
  <rect x="70" y="885" width="480" height="130" fill="#2d2d30" stroke="#c586c0" stroke-width="2" rx="8"/>
  <text x="310" y="908" font-family="Arial, sans-serif" font-size="18" font-weight="bold" fill="#c586c0" text-anchor="middle">
    OperationContext
  </text>
  <text x="90" y="930" font-family="Arial, sans-serif" font-size="13" fill="#d4d4d4">
    • operation_type, files, destination
  </text>
  <text x="90" y="948" font-family="Arial, sans-serif" font-size="13" fill="#d4d4d4">
    • conflicts: List[Tuple[source, dest]]
  </text>
  <text x="90" y="966" font-family="Arial, sans-serif" font-size="13" fill="#d4d4d4">
    • results: {success, skipped, errors}
  </text>
  <text x="90" y="984" font-family="Arial, sans-serif" font-size="13" fill="#d4d4d4">
    • options: {overwrite_all, skip_all, rename_all}
  </text>
  <text x="90" y="1002" font-family="Arial, sans-serif" font-size="13" fill="#d4d4d4">
    • current_conflict_index: int
  </text>
  
  <!-- ArchiveOperationContext -->
  <rect x="570" y="885" width="480" height="130" fill="#2d2d30" stroke="#c586c0" stroke-width="2" rx="8"/>
  <text x="810" y="908" font-family="Arial, sans-serif" font-size="18" font-weight="bold" fill="#c586c0" text-anchor="middle">
    ArchiveOperationContext
  </text>
  <text x="590" y="930" font-family="Arial, sans-serif" font-size="13" fill="#d4d4d4">
    • operation_type, source_paths, destination
  </text>
  <text x="590" y="948" font-family="Arial, sans-serif" font-size="13" fill="#d4d4d4">
    • format_type: str (tar.gz, zip, etc.)
  </text>
  <text x="590" y="966" font-family="Arial, sans-serif" font-size="13" fill="#d4d4d4">
    • conflicts: List[ConflictInfo]
  </text>
  <text x="590" y="984" font-family="Arial, sans-serif" font-size="13" fill="#d4d4d4">
    • results: {success, skipped, errors}
  </text>
  <text x="590" y="1002" font-family="Arial, sans-serif" font-size="13" fill="#d4d4d4">
    • options: {overwrite_all, skip_all}
  </text>
  
  <!-- Right Column: Delegation Pattern -->
  <text x="1100" y="140" font-family="Arial, sans-serif" font-size="26" font-weight="bold" fill="#4ec9b0">
    Delegation Pattern
  </text>
  
  <rect x="1100" y="155" width="750" height="220" fill="#2d2d30" stroke="#4fc1ff" stroke-width="3" rx="8"/>
  <text x="1475" y="182" font-family="Arial, sans-serif" font-size="20" font-weight="bold" fill="#4fc1ff" text-anchor="middle">
    Task Responsibilities
  </text>
  
  <text x="1120" y="210" font-family="Arial, sans-serif" font-size="17" font-weight="bold" fill="#569cd6">
    Task (State Machine Logic)
  </text>
  <text x="1140" y="230" font-family="Arial, sans-serif" font-size="14" fill="#d4d4d4">
    • State transitions &amp; workflow coordination
  </text>
  
  <text x="1120" y="258" font-family="Arial, sans-serif" font-size="17" font-weight="bold" fill="#ce9178">
    UI Component
  </text>
  <text x="1140" y="278" font-family="Arial, sans-serif" font-size="14" fill="#d4d4d4">
    • Confirmation dialogs
  </text>
  <text x="1140" y="298" font-family="Arial, sans-serif" font-size="14" fill="#d4d4d4">
    • Conflict resolution dialogs
  </text>
  <text x="1140" y="318" font-family="Arial, sans-serif" font-size="14" fill="#d4d4d4">
    • Rename dialogs
  </text>
  
  <text x="1120" y="346" font-family="Arial, sans-serif" font-size="17" font-weight="bold" fill="#dcdcaa">
    Executor Component
  </text>
  <text x="1140" y="366" font-family="Arial, sans-serif" font-size="14" fill="#d4d4d4">
    • Background thread execution &amp; File I/O operations
  </text>
  
  <!-- Key Features -->
  <rect x="1100" y="390" width="750" height="155" fill="#2d2d30" stroke="#4fc1ff" stroke-width="3" rx="8"/>
  <text x="1475" y="417" font-family="Arial, sans-serif" font-size="20" font-weight="bold" fill="#4fc1ff" text-anchor="middle">
    Key Features
  </text>
  <text x="1120" y="443" font-family="Arial, sans-serif" font-size="15" fill="#d4d4d4">
    • Conflict Detection: Checks for existing files
  </text>
  <text x="1120" y="466" font-family="Arial, sans-serif" font-size="15" fill="#d4d4d4">
    • Conflict Resolution: Overwrite/Skip/Rename
  </text>
  <text x="1120" y="489" font-family="Arial, sans-serif" font-size="15" fill="#d4d4d4">
    • Apply-to-All: Batch conflict handling
  </text>
  <text x="1120" y="512" font-family="Arial, sans-serif" font-size="15" fill="#d4d4d4">
    • Cancellation: ESC key support
  </text>
  <text x="1120" y="535" font-family="Arial, sans-serif" font-size="15" fill="#d4d4d4">
    • Progress Tracking: Real-time updates
  </text>
  
  <!-- FileManager Integration -->
  <rect x="1100" y="560" width="750" height="110" fill="#2d2d30" stroke="#4fc1ff" stroke-width="3" rx="8"/>
  <text x="1475" y="587" font-family="Arial, sans-serif" font-size="20" font-weight="bold" fill="#4fc1ff" text-anchor="middle">
    FileManager Integration
  </text>
  <text x="1120" y="613" font-family="Arial, sans-serif" font-size="15" fill="#d4d4d4">
    • start_task(task) - Begin task execution
  </text>
  <text x="1120" y="636" font-family="Arial, sans-serif" font-size="15" fill="#d4d4d4">
    • _clear_task() - Clean up after completion
  </text>
  <text x="1120" y="659" font-family="Arial, sans-serif" font-size="15" fill="#d4d4d4">
    • operation_in_progress flag management
  </text>
  
  <!-- Typical Workflow -->
  <rect x="1100" y="880" width="750" height="165" fill="#2d2d30" stroke="#4fc1ff" stroke-width="3" rx="8"/>
  <text x="1475" y="907" font-family="Arial, sans-serif" font-size="20" font-weight="bold" fill="#4fc1ff" text-anchor="middle">
    Typical Workflow
  </text>
  <text x="1120" y="931" font-family="Arial, sans-serif" font-size="14" fill="#d4d4d4">
    1. User initiates operation (copy/move/delete/archive)
  </text>
  <text x="1120" y="950" font-family="Arial, sans-serif" font-size="14" fill="#d4d4d4">
    2. Task shows confirmation dialog (if enabled)
  </text>
  <text x="1120" y="969" font-family="Arial, sans-serif" font-size="14" fill="#d4d4d4">
    3. Task detects conflicts (existing files)
  </text>
  <text x="1120" y="988" font-family="Arial, sans-serif" font-size="14" fill="#d4d4d4">
    4. User resolves conflicts (overwrite/skip/rename)
  </text>
  <text x="1120" y="1007" font-family="Arial, sans-serif" font-size="14" fill="#d4d4d4">
    5. Executor performs operation in background thread
  </text>
  <text x="1120" y="1026" font-family="Arial, sans-serif" font-size="14" fill="#d4d4d4">
    6. Task completes and returns to IDLE state
  </text>
  
  <!-- Inheritance arrows -->
  <line x1="330" y1="290" x2="310" y2="340" stroke="#569cd6" stroke-width="2" marker-end="url(#arrow)"/>
  <line x1="330" y1="290" x2="310" y2="510" stroke="#569cd6" stroke-width="2" marker-end="url(#arrow)"/>
  <text x="250" y="320" font-family="Arial, sans-serif" font-size="13" fill="#569cd6">inherits</text>
  <text x="250" y="490" font-family="Arial, sans-serif" font-size="13" fill="#569cd6">inherits</text>
</svg>
