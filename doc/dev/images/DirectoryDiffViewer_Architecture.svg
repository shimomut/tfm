<svg viewBox="0 0 1920 1080" xmlns="http://www.w3.org/2000/svg">
  <!-- Background -->
  <rect width="1920" height="1080" fill="#1e1e1e"/>
  
  <!-- Title -->
  <text x="960" y="80" font-family="Arial, sans-serif" font-size="48" font-weight="bold" fill="#ffffff" text-anchor="middle">
    DirectoryDiffViewer Architecture
  </text>
  
  <!-- Subtitle -->
  <text x="960" y="130" font-family="Arial, sans-serif" font-size="24" fill="#cccccc" text-anchor="middle">
    Progressive Recursive Directory Comparison with Tree Display
  </text>
  
  <!-- Main Components Section -->
  <text x="100" y="200" font-family="Arial, sans-serif" font-size="32" font-weight="bold" fill="#4ec9b0">
    Core Components
  </text>
  
  <!-- DirectoryDiffViewer (Main Component) -->
  <rect x="100" y="230" width="500" height="180" fill="#2d2d30" stroke="#569cd6" stroke-width="3" rx="10"/>
  <text x="350" y="265" font-family="Arial, sans-serif" font-size="24" font-weight="bold" fill="#569cd6" text-anchor="middle">
    DirectoryDiffViewer
  </text>
  <text x="120" y="300" font-family="Arial, sans-serif" font-size="18" fill="#d4d4d4">
    • UILayer implementation
  </text>
  <text x="120" y="330" font-family="Arial, sans-serif" font-size="18" fill="#d4d4d4">
    • Manages tree state &amp; navigation
  </text>
  <text x="120" y="360" font-family="Arial, sans-serif" font-size="18" fill="#d4d4d4">
    • Handles keyboard/mouse events
  </text>
  <text x="120" y="390" font-family="Arial, sans-serif" font-size="18" fill="#d4d4d4">
    • Renders dual-pane tree view
  </text>
  
  <!-- DirectoryScanner -->
  <rect x="700" y="230" width="500" height="180" fill="#2d2d30" stroke="#ce9178" stroke-width="3" rx="10"/>
  <text x="950" y="265" font-family="Arial, sans-serif" font-size="24" font-weight="bold" fill="#ce9178" text-anchor="middle">
    DirectoryScanner
  </text>
  <text x="720" y="300" font-family="Arial, sans-serif" font-size="18" fill="#d4d4d4">
    • Recursive directory traversal
  </text>
  <text x="720" y="330" font-family="Arial, sans-serif" font-size="18" fill="#d4d4d4">
    • Collects FileInfo metadata
  </text>
  <text x="720" y="360" font-family="Arial, sans-serif" font-size="18" fill="#d4d4d4">
    • Progress callbacks
  </text>
  <text x="720" y="390" font-family="Arial, sans-serif" font-size="18" fill="#d4d4d4">
    • Cancellation support
  </text>
  
  <!-- DiffEngine -->
  <rect x="1300" y="230" width="500" height="180" fill="#2d2d30" stroke="#dcdcaa" stroke-width="3" rx="10"/>
  <text x="1550" y="265" font-family="Arial, sans-serif" font-size="24" font-weight="bold" fill="#dcdcaa" text-anchor="middle">
    DiffEngine
  </text>
  <text x="1320" y="300" font-family="Arial, sans-serif" font-size="18" fill="#d4d4d4">
    • Builds unified tree structure
  </text>
  <text x="1320" y="330" font-family="Arial, sans-serif" font-size="18" fill="#d4d4d4">
    • Classifies differences
  </text>
  <text x="1320" y="360" font-family="Arial, sans-serif" font-size="18" fill="#d4d4d4">
    • File content comparison
  </text>
  <text x="1320" y="390" font-family="Arial, sans-serif" font-size="18" fill="#d4d4d4">
    • Bottom-up tree classification
  </text>
  
  <!-- Data Structures Section -->
  <text x="100" y="480" font-family="Arial, sans-serif" font-size="32" font-weight="bold" fill="#4ec9b0">
    Key Data Structures
  </text>
  
  <!-- TreeNode -->
  <rect x="100" y="510" width="380" height="200" fill="#2d2d30" stroke="#c586c0" stroke-width="2" rx="8"/>
  <text x="290" y="540" font-family="Arial, sans-serif" font-size="20" font-weight="bold" fill="#c586c0" text-anchor="middle">
    TreeNode
  </text>
  <text x="120" y="570" font-family="Arial, sans-serif" font-size="16" fill="#d4d4d4">
    • name, depth, parent, children[]
  </text>
  <text x="120" y="595" font-family="Arial, sans-serif" font-size="16" fill="#d4d4d4">
    • left_path, right_path
  </text>
  <text x="120" y="620" font-family="Arial, sans-serif" font-size="16" fill="#d4d4d4">
    • is_directory, is_expanded
  </text>
  <text x="120" y="645" font-family="Arial, sans-serif" font-size="16" fill="#d4d4d4">
    • difference_type (enum)
  </text>
  <text x="120" y="670" font-family="Arial, sans-serif" font-size="16" fill="#d4d4d4">
    • children_scanned, content_compared
  </text>
  <text x="120" y="695" font-family="Arial, sans-serif" font-size="16" fill="#d4d4d4">
    • scan_in_progress (progressive)
  </text>
  
  <!-- FileInfo -->
  <rect x="540" y="510" width="380" height="200" fill="#2d2d30" stroke="#c586c0" stroke-width="2" rx="8"/>
  <text x="730" y="540" font-family="Arial, sans-serif" font-size="20" font-weight="bold" fill="#c586c0" text-anchor="middle">
    FileInfo
  </text>
  <text x="560" y="570" font-family="Arial, sans-serif" font-size="16" fill="#d4d4d4">
    • path, relative_path
  </text>
  <text x="560" y="595" font-family="Arial, sans-serif" font-size="16" fill="#d4d4d4">
    • is_directory, size, mtime
  </text>
  <text x="560" y="620" font-family="Arial, sans-serif" font-size="16" fill="#d4d4d4">
    • is_accessible
  </text>
  <text x="560" y="645" font-family="Arial, sans-serif" font-size="16" fill="#d4d4d4">
    • error_message (optional)
  </text>
  
  <!-- DifferenceType Enum -->
  <rect x="980" y="510" width="380" height="200" fill="#2d2d30" stroke="#c586c0" stroke-width="2" rx="8"/>
  <text x="1170" y="540" font-family="Arial, sans-serif" font-size="20" font-weight="bold" fill="#c586c0" text-anchor="middle">
    DifferenceType (Enum)
  </text>
  <text x="1000" y="570" font-family="Arial, sans-serif" font-size="16" fill="#d4d4d4">
    • IDENTICAL
  </text>
  <text x="1000" y="595" font-family="Arial, sans-serif" font-size="16" fill="#d4d4d4">
    • ONLY_LEFT / ONLY_RIGHT
  </text>
  <text x="1000" y="620" font-family="Arial, sans-serif" font-size="16" fill="#d4d4d4">
    • CONTENT_DIFFERENT
  </text>
  <text x="1000" y="645" font-family="Arial, sans-serif" font-size="16" fill="#d4d4d4">
    • CONTAINS_DIFFERENCE
  </text>
  <text x="1000" y="670" font-family="Arial, sans-serif" font-size="16" fill="#d4d4d4">
    • PENDING (progressive scan)
  </text>
  
  <!-- Progressive Scanning -->
  <rect x="1420" y="510" width="380" height="200" fill="#2d2d30" stroke="#c586c0" stroke-width="2" rx="8"/>
  <text x="1610" y="540" font-family="Arial, sans-serif" font-size="20" font-weight="bold" fill="#c586c0" text-anchor="middle">
    Work Queues
  </text>
  <text x="1440" y="570" font-family="Arial, sans-serif" font-size="16" fill="#d4d4d4">
    • scan_queue (directories)
  </text>
  <text x="1440" y="595" font-family="Arial, sans-serif" font-size="16" fill="#d4d4d4">
    • priority_queue (visible items)
  </text>
  <text x="1440" y="620" font-family="Arial, sans-serif" font-size="16" fill="#d4d4d4">
    • comparison_queue (files)
  </text>
  <text x="1440" y="645" font-family="Arial, sans-serif" font-size="16" fill="#d4d4d4">
    • ScanTask / ComparisonTask
  </text>
  <text x="1440" y="670" font-family="Arial, sans-serif" font-size="16" fill="#d4d4d4">
    • Priority-based scheduling
  </text>
  
  <!-- Threading Architecture -->
  <text x="100" y="770" font-family="Arial, sans-serif" font-size="32" font-weight="bold" fill="#4ec9b0">
    Threading Architecture
  </text>
  
  <!-- Main Thread -->
  <rect x="100" y="800" width="500" height="150" fill="#2d2d30" stroke="#4fc1ff" stroke-width="3" rx="10"/>
  <text x="350" y="835" font-family="Arial, sans-serif" font-size="24" font-weight="bold" fill="#4fc1ff" text-anchor="middle">
    Main Thread (UI)
  </text>
  <text x="120" y="870" font-family="Arial, sans-serif" font-size="18" fill="#d4d4d4">
    • Event handling (keyboard/mouse)
  </text>
  <text x="120" y="900" font-family="Arial, sans-serif" font-size="18" fill="#d4d4d4">
    • Rendering (dual-pane tree view)
  </text>
  <text x="120" y="930" font-family="Arial, sans-serif" font-size="18" fill="#d4d4d4">
    • Tree navigation &amp; expansion
  </text>
  
  <!-- Scanner Thread -->
  <rect x="700" y="800" width="500" height="150" fill="#2d2d30" stroke="#ce9178" stroke-width="3" rx="10"/>
  <text x="950" y="835" font-family="Arial, sans-serif" font-size="24" font-weight="bold" fill="#ce9178" text-anchor="middle">
    Scanner Thread
  </text>
  <text x="720" y="870" font-family="Arial, sans-serif" font-size="18" fill="#d4d4d4">
    • Processes scan_queue
  </text>
  <text x="720" y="900" font-family="Arial, sans-serif" font-size="18" fill="#d4d4d4">
    • Lists directory contents
  </text>
  <text x="720" y="930" font-family="Arial, sans-serif" font-size="18" fill="#d4d4d4">
    • Updates tree incrementally
  </text>
  
  <!-- Comparator Thread -->
  <rect x="1300" y="800" width="500" height="150" fill="#2d2d30" stroke="#dcdcaa" stroke-width="3" rx="10"/>
  <text x="1550" y="835" font-family="Arial, sans-serif" font-size="24" font-weight="bold" fill="#dcdcaa" text-anchor="middle">
    Comparator Thread
  </text>
  <text x="1320" y="870" font-family="Arial, sans-serif" font-size="18" fill="#d4d4d4">
    • Processes comparison_queue
  </text>
  <text x="1320" y="900" font-family="Arial, sans-serif" font-size="18" fill="#d4d4d4">
    • Compares file content
  </text>
  <text x="1320" y="930" font-family="Arial, sans-serif" font-size="18" fill="#d4d4d4">
    • Updates node classifications
  </text>
  
  <!-- Synchronization -->
  <text x="100" y="1010" font-family="Arial, sans-serif" font-size="28" font-weight="bold" fill="#4ec9b0">
    Thread Synchronization
  </text>
  <text x="100" y="1045" font-family="Arial, sans-serif" font-size="18" fill="#d4d4d4">
    • tree_lock (RLock) - Protects tree structure during updates
  </text>
  <text x="100" y="1070" font-family="Arial, sans-serif" font-size="18" fill="#d4d4d4">
    • data_lock (RLock) - Protects file dictionaries (left_files, right_files)
  </text>
  
  <!-- Arrows showing data flow -->
  <!-- Scanner to DiffEngine -->
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#569cd6"/>
    </marker>
  </defs>
  
  <line x1="600" y1="320" x2="700" y2="320" stroke="#569cd6" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="650" y="310" font-family="Arial, sans-serif" font-size="14" fill="#569cd6" text-anchor="middle">uses</text>
  
  <line x1="1200" y1="320" x2="1300" y2="320" stroke="#569cd6" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="1250" y="310" font-family="Arial, sans-serif" font-size="14" fill="#569cd6" text-anchor="middle">feeds</text>
  
  <!-- Threading connections -->
  <line x1="350" y1="410" x2="350" y2="800" stroke="#4fc1ff" stroke-width="2" stroke-dasharray="5,5"/>
  <line x1="950" y1="410" x2="950" y2="800" stroke="#ce9178" stroke-width="2" stroke-dasharray="5,5"/>
  <line x1="1550" y1="410" x2="1550" y2="800" stroke="#dcdcaa" stroke-width="2" stroke-dasharray="5,5"/>
</svg>
